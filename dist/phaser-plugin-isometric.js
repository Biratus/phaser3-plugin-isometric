module.exports=function(t){var i={};function s(e){if(i[e])return i[e].exports;var h=i[e]={i:e,l:!1,exports:{}};return t[e].call(h.exports,h,h.exports,s),h.l=!0,h.exports}return s.m=t,s.c=i,s.d=function(t,i,e){s.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:e})},s.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},s.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(i,"a",i),i},s.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},s.p="/",s(s.s=8)}([function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=function(){function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,s,e){return s&&t(i.prototype,s),e&&t(i,e),i}}();var h=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=i,this.y=s,this.z=e}return e(t,[{key:"copyFrom",value:function(t){return this.setTo(t.x,t.y,t.z)}},{key:"copyTo",value:function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t}},{key:"equals",value:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}},{key:"set",value:function(t,i,s){this.x=t||0,this.y=i||(0!==i?this.x:0),this.z=s||(void 0===i?this.x:0)}},{key:"setTo",value:function(t,i,s){return this.set(t,i,s)}},{key:"add",value:function(t,i,s){return this.x+=t||0,this.y+=i||0,this.z+=s||0,this}},{key:"subtract",value:function(t,i,s){return this.x-=t||0,this.y-=i||0,this.z-=s||0,this}},{key:"multiply",value:function(t,i,s){return this.x*=t||1,this.y*=i||1,this.z*=s||1,this}},{key:"divide",value:function(t,i,s){return this.x/=t||1,this.y/=i||1,this.z/=s||1,this}}],[{key:"add",value:function(i,s){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t;return e.x=i.x+s.x,e.y=i.y+s.y,e.z=i.z+s.z,e}},{key:"subtract",value:function(i,s){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t;return e.x=i.x-s.x,e.y=i.y-s.y,e.z=i.z-s.z,e}},{key:"multiply",value:function(i,s){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t;return e.x=i.x*s.x,e.y=i.y*s.y,e.z=i.z*s.z,e}},{key:"divide",value:function(i,s){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new t;return e.x=i.x/s.x,e.y=i.y/s.y,e.z=i.z/s.z,e}},{key:"equals",value:function(t,i){return t.x===i.x&&t.y===i.y&&t.z===i.z}}]),t}();i.default=h},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e,h=function(){function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,s,e){return s&&t(i.prototype,s),e&&t(i,e),i}}(),o=s(0),n=(e=o)&&e.__esModule?e:{default:e};var r=function(){function t(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,h=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.x=i,this.y=s,this.z=e,this.widthX=h,this.widthY=o,this.height=r,this._corners=[new n.default(this.x,this.y,this.z),new n.default(this.x,this.y,this.z+this.height),new n.default(this.x,this.y+this.widthY,this.z),new n.default(this.x,this.y+this.widthY,this.z+this.height),new n.default(this.x+this.widthX,this.y,this.z),new n.default(this.x+this.widthX,this.y,this.z+this.height),new n.default(this.x+this.widthX,this.y+this.widthY,this.z),new n.default(this.x+this.widthX,this.y+this.widthY,this.z+this.height)]}return h(t,[{key:"setTo",value:function(t,i,s,e,h,o){return this.x=t,this.y=i,this.z=s,this.widthX=e,this.widthY=h,this.height=o,this}},{key:"copyFrom",value:function(t){this.setTo(t.x,t.y,t.z,t.widthX,t.widthY,t.height)}},{key:"copyTo",value:function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t.widthX=this.widthX,t.widthY=this.widthY,t.height=this.height,t}},{key:"size",value:function(i){return t.size(this,i)}},{key:"contains",value:function(i,s,e){return t.contains(this,i,s,e)}},{key:"containsXY",value:function(i,s){return t.containsXY(this,i,s)}},{key:"clone",value:function(i){return t.clone(this,i)}},{key:"intersects",value:function(i){return t.intersects(this,i)}},{key:"getCorners",value:function(){return this._corners[0].setTo(this.x,this.y,this.z),this._corners[1].setTo(this.x,this.y,this.z+this.height),this._corners[2].setTo(this.x,this.y+this.widthY,this.z),this._corners[3].setTo(this.x,this.y+this.widthY,this.z+this.height),this._corners[4].setTo(this.x+this.widthX,this.y,this.z),this._corners[5].setTo(this.x+this.widthX,this.y,this.z+this.height),this._corners[6].setTo(this.x+this.widthX,this.y+this.widthY,this.z),this._corners[7].setTo(this.x+this.widthX,this.y+this.widthY,this.z+this.height),this._corners}},{key:"toString",value:function(){return"[{Cube (x="+this.x+" y="+this.y+" z="+this.z+" widthX="+this.widthX+" widthY="+this.widthY+" height="+this.height+" empty="+this.empty+")}]"}},{key:"halfWidthX",get:function(){return Math.round(.5*this.widthX)}},{key:"halfWidthY",get:function(){return Math.round(.5*this.widthY)}},{key:"halfHeight",get:function(){return Math.round(.5*this.height)}},{key:"bottom",get:function(){return this.z},set:function(t){t>=this.top?this.height=0:this.height=this.top-t,this.z=t}},{key:"top",get:function(){return this.z+this.height},set:function(t){t<=this.z?this.height=0:this.height=t-this.z}},{key:"backX",get:function(){return this.x},set:function(t){t>=this.frontX?this.widthX=0:this.widthX=this.frontX-t,this.x=t}},{key:"backY",get:function(){return this.y},set:function(t){t>=this.frontY?this.widthY=0:this.widthY=this.frontY-t,this.y=t}},{key:"frontX",get:function(){return this.x+this.widthX},set:function(t){t<=this.x?this.widthX=0:this.widthX=t-this.x}},{key:"frontY",get:function(){return this.y+this.widthY},set:function(t){t<=this.y?this.widthY=0:this.widthY=t-this.y}},{key:"volume",get:function(){return this.widthX*this.widthY*this.height}},{key:"centerX",get:function(){return this.x+this.halfWidthX},set:function(t){this.x=t-this.halfWidthX}},{key:"centerY",get:function(){return this.y+this.halfWidthY},set:function(t){this.y=t-this.halfWidthY}},{key:"centerZ",get:function(){return this.z+this.halfHeight},set:function(t){this.z=t-this.halfHeight}},{key:"randomX",get:function(){return this.x+Math.random()*this.widthX}},{key:"randomY",get:function(){return this.y+Math.random()*this.widthY}},{key:"randomZ",get:function(){return this.z+Math.random()*this.height}},{key:"empty",get:function(){return!this.widthX||!this.widthY||!this.height},set:function(t){!0===t&&this.setTo(0,0,0,0,0,0)}}],[{key:"size",value:function(t,i){return void 0===i||null===i?i=new n.default(t.widthX,t.widthY,t.height):i.setTo(t.widthX,t.widthY,t.height),i}},{key:"clone",value:function(i,s){return void 0===s||null===s?s=new t(i.x,i.y,i.z,i.widthX,i.widthY,i.height):s.setTo(i.x,i.y,i.z,i.widthX,i.widthY,i.height),s}},{key:"contains",value:function(t,i,s,e){return!(t.widthX<=0||t.widthY<=0||t.height<=0)&&(i>=t.x&&i<=t.frontX&&s>=t.y&&s<=t.frontY&&e>=t.z&&e<=t.top)}},{key:"containsXY",value:function(t,i,s){return!(t.widthX<=0||t.widthY<=0)&&(i>=t.x&&i<=t.frontX&&s>=t.y&&s<=t.frontY)}},{key:"containsPoint3",value:function(i,s){return t.contains(i,s.x,s.y,s.z)}},{key:"containsCube",value:function(t,i){return!(t.volume>i.volume)&&(t.x>=i.x&&t.y>=i.y&&t.z>=i.z&&t.frontX<=i.frontX&&t.frontY<=i.frontY&&t.top<=i.top)}},{key:"intersects",value:function(t,i){return!(t.widthX<=0||t.widthY<=0||t.height<=0||i.widthX<=0||i.widthY<=0||i.height<=0)&&!(t.frontX<i.x||t.frontY<i.y||t.x>i.frontX||t.y>i.frontY||t.z>i.top||t.top<i.z)}}]),t}();i.default=r},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ISOPHYSICS=i.ISOSPRITE=i.BACKWARDY=i.BACKWARDX=i.FORWARDY=i.FORWARDX=i.DOWN=i.UP=i.VERSION=i.IsoPhysics=void 0;var e=function(){function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,s,e){return s&&t(i.prototype,s),e&&t(i,e),i}}(),h=s(7);
/**
 * @author       Lewis Lane <lew@rotates.org>
 * @copyright    2015 Lewis Lane (Rotates.org)
 * @license      {@link http://opensource.org/licenses/MIT|MIT License}
 */Object.defineProperty(i,"IsoPhysics",{enumerable:!0,get:function(){return r(h).default}});var o=r(s(4)),n=r(s(3));function r(t){return t&&t.__esModule?t:{default:t}}i.VERSION="0.9.3",i.UP=0,i.DOWN=1,i.FORWARDX=2,i.FORWARDY=3,i.BACKWARDX=4,i.BACKWARDY=5,i.ISOSPRITE="IsoSprite",i.ISOPHYSICS="IsoPhysics";var a=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.scene=i,this.systems=i.sys,i.sys.settings.isBooted||i.sys.events.once("boot",this.boot,this),this.projector=new o.default(i,i.isometricType),Phaser.GameObjects.GameObjectCreator.register("isoSprite",function(t,i,s,e,h){return new n.default(this.scene,t,i,s,e,h)}),Phaser.GameObjects.GameObjectFactory.register("isoSprite",function(t,i,s,e){var h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments[5],r=new n.default(this.scene,t,i,s,e,h);return void 0===o?(this.displayList.add(r),this.updateList.add(r)):o.add(r,!0),r})}return e(t,[{key:"boot",value:function(){}}],[{key:"register",value:function(i){i.register("IsoPlugin",t,"isoPlugin")}}]),t}();i.default=a},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=function(){function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,s,e){return s&&t(i.prototype,s),e&&t(i,e),i}}(),h=s(2),o=r(s(0)),n=r(s(1));function r(t){return t&&t.__esModule?t:{default:t}}var a=function(t){function i(t,s,e,n,r,a){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,i);var l=function(t,i){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!i||"object"!=typeof i&&"function"!=typeof i?t:i}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,t,s,e,r,a));return l.type=h.ISOSPRITE,l._isoPosition=new o.default(s,e,n),l.snap=0,l._isoPositionChanged=!0,l._isoBoundsChanged=!0,l._project(),l._isoBounds=l.resetIsoBounds(),l}return function(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function, not "+typeof i);t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i&&(Object.setPrototypeOf?Object.setPrototypeOf(t,i):t.__proto__=i)}(i,Phaser.GameObjects.Sprite),e(i,[{key:"_project",value:function(){if(this._isoPositionChanged){var t=this.scene.sys.settings.map.isoPlugin,i=this.scene[t].projector.project(this._isoPosition),s=i.x,e=i.y;this.x=s,this.y=e,this.depth=this._isoPosition.x+this._isoPosition.y+1.25*this._isoPosition.z,this.snap>0&&(this.x=Phaser.Math.snapTo(this.x,this.snap),this.y=Phaser.Math.snapTo(this.y,this.snap)),this._isoPositionChanged=this._isoBoundsChanged=!0}}},{key:"preUpdate",value:function(){Phaser.GameObjects.Sprite.prototype.preUpdate.call(this),this._project()}},{key:"resetIsoBounds",value:function(){void 0===this._isoBounds&&(this._isoBounds=new n.default);var t=Math.abs(this.scaleX),i=Math.abs(this.scaleY);return this._isoBounds.widthX=Math.round(.5*Math.abs(this.width))*t,this._isoBounds.widthY=Math.round(.5*Math.abs(this.width))*t,this._isoBounds.height=Math.round(Math.abs(this.height)-.5*Math.abs(this.width))*i,this._isoBounds.x=this.isoX+this._isoBounds.widthX*-this.originX+.5*this._isoBounds.widthX,this._isoBounds.y=this.isoY+this._isoBounds.widthY*this.originX-.5*this._isoBounds.widthY,this._isoBounds.z=this.isoZ-Math.abs(this.height)*(1-this.originY)+Math.abs(.5*this.width),this._isoBounds}},{key:"isoX",get:function(){return this._isoPosition.x},set:function(t){this._isoPosition.x=t,this._isoPositionChanged=this._isoBoundsChanged=!0,this.body&&(this.body._reset=!0)}},{key:"isoY",get:function(){return this._isoPosition.y},set:function(t){this._isoPosition.y=t,this._isoPositionChanged=this._isoBoundsChanged=!0,this.body&&(this.body._reset=!0)}},{key:"isoZ",get:function(){return this._isoPosition.z},set:function(t){this._isoPosition.z=t,this._isoPositionChanged=this._isoBoundsChanged=!0,this.body&&(this.body._reset=!0)}},{key:"isoPosition",get:function(){return this._isoPosition}},{key:"isoBounds",get:function(){return!this._isoBoundsChanged&&this._isoBounds||(this.resetIsoBounds(),this._isoBoundsChanged=!1),this._isoBounds}}]),i}();i.default=a},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.MILITARY=i.ISOMETRIC=i.CLASSIC=void 0;var e,h=function(){function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,s,e){return s&&t(i.prototype,s),e&&t(i,e),i}}(),o=s(0),n=(e=o)&&e.__esModule?e:{default:e};var r=i.CLASSIC=Math.atan(.5),a=(i.ISOMETRIC=Math.PI/6,i.MILITARY=Math.PI/4,function(){function t(i,s){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.scene=i,this._transform=null,this._projectionAngle=0,this.projectionAngle=s||r,this.anchor=new Phaser.Geom.Point(.5,.5)}return h(t,[{key:"project",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Phaser.Geom.Point;i.x=(t.x-t.y)*this._transform[0],i.y=(t.x+t.y)*this._transform[1]-t.z;var s=this.scene.sys.game.config,e=s.width,h=s.height;return i.x+=e*this.anchor.x,i.y+=h*this.anchor.y,i}},{key:"projectXY",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Phaser.Geom.Point;return i.x=(t.x-t.y)*this._transform[0],i.y=(t.x+t.y)*this._transform[1],i.x+=this.game.world.width*this.anchor.x,i.y+=this.game.world.height*this.anchor.y,i}},{key:"unproject",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new n.default,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,e=t.x-this.game.world.x-this.game.world.width*this.anchor.x,h=t.y-this.game.world.y-this.game.world.height*this.anchor.y+s;return i.x=e/(2*this._transform[0])+h/(2*this._transform[1]),i.y=-e/(2*this._transform[0])+h/(2*this._transform[1]),i.z=s,i}},{key:"projectionAngle",set:function(t){t!==this._projectionAngle&&(this._projectionAngle=t,this._transform=[Math.cos(this._projectionAngle),Math.sin(this._projectionAngle)])},get:function(){return this._projectionAngle}}]),t}());i.default=a},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e,h=function(){function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,s,e){return s&&t(i.prototype,s),e&&t(i,e),i}}(),o=s(1),n=(e=o)&&e.__esModule?e:{default:e};var r=function(){function t(i,s,e,h,o,n,r,a,l){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.maxObjects=10,this.maxLevels=4,this.level=0,this.bounds={},this.objects=[],this.nodes=[],this._empty=[],this.reset(i,s,e,h,o,n,r,a,l)}return h(t,[{key:"reset",value:function(t,i,s,e,h,o,n,r,a){this.maxObjects=n||10,this.maxLevels=r||4,this.level=a||0,this.bounds={x:Math.round(t),y:Math.round(i),z:Math.round(s),widthX:e,widthY:h,height:o,subWidthX:Math.floor(.5*e),subWidthY:Math.floor(.5*h),subHeight:Math.floor(.5*o),frontX:Math.round(t)+Math.floor(.5*e),frontY:Math.round(i)+Math.floor(.5*h),top:Math.round(s)+Math.floor(.5*o)},this.objects.length=0,this.nodes.length=0}},{key:"populate",value:function(t){t.forEach(this.populateHandler,this,!0)}},{key:"populateHandler",value:function(t){t.body&&t.exists&&this.insert(t.body)}},{key:"split",value:function(){this.nodes[0]=new t(this.bounds.x,this.bounds.y,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[1]=new t(this.bounds.frontX,this.bounds.y,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[2]=new t(this.bounds.x,this.bounds.frontY,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[3]=new t(this.bounds.frontX,this.bounds.frontY,this.bounds.z,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[4]=new t(this.bounds.x,this.bounds.y,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[5]=new t(this.bounds.frontX,this.bounds.y,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[6]=new t(this.bounds.x,this.bounds.frontY,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1),this.nodes[7]=new t(this.bounds.frontX,this.bounds.frontY,this.bounds.top,this.bounds.subWidthX,this.bounds.subWidthY,this.bounds.subHeight,this.maxLevels,this.level+1)}},{key:"insert",value:function(t){var i,s=0;if(null==this.nodes[0]||-1==(i=this.getIndex(t))){if(this.objects.push(t),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(null==this.nodes[0]&&this.split();s<this.objects.length;)-1!=(i=this.getIndex(this.objects[s]))?this.nodes[i].insert(this.objects.splice(s,1)[0]):s++}else this.nodes[i].insert(t)}},{key:"getIndex",value:function(t){var i=-1;return t.x<this.bounds.frontX&&t.frontX<this.bounds.frontX?t.y<this.bounds.frontY&&t.frontY<this.bounds.frontY?t.z<this.bounds.top&&t.top<this.bounds.top?i=0:t.z>this.bounds.top&&(i=4):t.y>this.bounds.frontY&&(t.z<this.bounds.top&&t.top<this.bounds.top?i=2:t.z>this.bounds.top&&(i=6)):t.x>this.bounds.frontX&&(t.y<this.bounds.frontY&&t.frontY<this.bounds.frontY?t.z<this.bounds.top&&t.top<this.bounds.top?i=1:t.z>this.bounds.top&&(i=5):t.y>this.bounds.frontY&&(t.z<this.bounds.top&&t.top<this.bounds.top?i=3:t.z>this.bounds.top&&(i=7))),i}},{key:"retrieve",value:function(t){var i,s;if(t instanceof n.default)i=this.objects,s=this.getIndex(t);else{if(!t.body)return this._empty;i=this.objects,s=this.getIndex(t.body)}return this.nodes[0]&&(i=-1!==s?i.concat(this.nodes[s].retrieve(t)):(i=(i=(i=(i=(i=(i=(i=i.concat(this.nodes[0].retrieve(t))).concat(this.nodes[1].retrieve(t))).concat(this.nodes[2].retrieve(t))).concat(this.nodes[3].retrieve(t))).concat(this.nodes[4].retrieve(t))).concat(this.nodes[5].retrieve(t))).concat(this.nodes[6].retrieve(t))).concat(this.nodes[7].retrieve(t))),i}},{key:"clear",value:function(){this.objects.length=0;for(var t=this.nodes.length;t--;)this.nodes[t].clear(),this.nodes.splice(t,1);this.nodes.length=0}}]),t}();i.default=r},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=function(){function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,s,e){return s&&t(i.prototype,s),e&&t(i,e),i}}(),h=r(s(0)),o=r(s(1)),n=s(2);function r(t){return t&&t.__esModule?t:{default:t}}var a=function(){function t(i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.sprite=i,this.scene=i.scene,this.type=n.ISOPHYSICS,this.enable=!0,this.offset=new h.default,this.position=new h.default(i.isoX,i.isoY,i.isoZ),this.prev=new h.default(this.position.x,this.position.y,this.position.z),this.allowRotation=!0,this.rotation=i.rotation,this.preRotation=i.rotation,this.sourceWidthX=i.width/i.scaleX,this.sourceWidthY=i.width/i.scaleX,this.sourceHeight=i.height/i.scaleY,this.widthX=Math.ceil(.5*i.width),this.widthY=Math.ceil(.5*i.width),this.height=i.height-Math.ceil(.5*i.width),this.halfWidthX=Math.abs(.5*this.widthX),this.halfWidthY=Math.abs(.5*this.widthY),this.halfHeight=Math.abs(.5*this.height),this.center=new h.default(i.isoX+this.halfWidthX,i.isoY+this.halfWidthY,i.isoZ+this.halfHeight),this.velocity=new h.default,this.newVelocity=new h.default,this.deltaMax=new h.default,this.acceleration=new h.default,this.drag=new h.default,this.allowGravity=!0,this.gravity=new h.default,this.bounce=new h.default,this.maxVelocity=new h.default(1e4,1e4,1e4),this.angularVelocity=0,this.angularAcceleration=0,this.angularDrag=0,this.maxAngular=1e3,this.mass=1,this.angle=0,this.speed=0,this.facing=Phaser.NONE,this.immovable=!1,this.moves=!0,this.customSeparateX=!1,this.customSeparateY=!1,this.customSeparateZ=!1,this.overlapX=0,this.overlapY=0,this.overlapZ=0,this.embedded=!1,this.collideWorldBounds=!1,this.checkCollision={none:!1,any:!0,up:!0,down:!0,frontX:!0,frontY:!0,backX:!0,backY:!0},this.touching={none:!0,up:!1,down:!1,frontX:!1,frontY:!1,backX:!1,backY:!1},this.wasTouching={none:!0,up:!1,down:!1,frontX:!1,frontY:!1,backX:!1,backY:!1},this.blocked={up:!1,down:!1,frontX:!1,frontY:!1,backX:!1,backY:!1},this.phase=0,this.skipTree=!1,this._reset=!0,this._sx=i.scaleX,this._sy=i.scaleY,this._dx=0,this._dy=0,this._dz=0,this._corners=[new h.default(this.x,this.y,this.z),new h.default(this.x,this.y,this.z+this.height),new h.default(this.x,this.y+this.widthY,this.z),new h.default(this.x,this.y+this.widthY,this.z+this.height),new h.default(this.x+this.widthX,this.y,this.z),new h.default(this.x+this.widthX,this.y,this.z+this.height),new h.default(this.x+this.widthX,this.y+this.widthY,this.z),new h.default(this.x+this.widthX,this.y+this.widthY,this.z+this.height)]}return e(t,[{key:"updateBounds",value:function(){var t=Math.abs(this.sprite.scaleX),i=Math.abs(this.sprite.scaleY);t===this._sx&&i===this._sy||(this.widthX=Math.ceil(.5*this.sprite.width),this.widthY=Math.ceil(.5*this.sprite.width),this.height=Math.ceil(this.sprite.height-.5*this.sprite.width),this.halfWidthX=Math.floor(.5*this.widthX),this.halfWidthY=Math.floor(.5*this.widthY),this.halfHeight=Math.floor(.5*this.height),this._sx=t,this._sy=i,this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight),this._reset=!0)}},{key:"preUpdate",value:function(t,i){this.enable&&(this.phase=1,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.backX=this.touching.backX,this.wasTouching.backY=this.touching.backY,this.wasTouching.frontX=this.touching.frontX,this.wasTouching.frontY=this.touching.frontY,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.backX=!1,this.touching.backY=!1,this.touching.frontX=!1,this.touching.frontY=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.frontY=!1,this.blocked.frontX=!1,this.blocked.backY=!1,this.blocked.backX=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.isoX+(this.widthX*-this.sprite.originX+.5*this.widthX)+this.offset.x,this.position.y=this.sprite.isoY+(this.widthY*this.sprite.originX-.5*this.widthY)+this.offset.y,this.position.z=this.sprite.isoZ-Math.abs(this.sprite.height)*(1-this.sprite.originY)+Math.abs(.5*this.sprite.width)+this.offset.z,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||!0===this.sprite.fresh)&&(this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z),this.moves&&(i/=1e3,this.scene.isoPhysics.updateMotion(this,i),this.newVelocity.set(this.velocity.x*i,this.velocity.y*i,this.velocity.z*i),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,this.position.z+=this.newVelocity.z,this.position.x===this.prev.x&&this.position.y===this.prev.y&&this.position.z===this.prev.z||(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y+this.velocity.z*this.velocity.z),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds(),this.sprite.outOfBoundsKill&&!this.scene.isoPhysics.bounds.intersects(this.sprite.isoBounds)&&this.sprite.kill()),this._dx=this.deltaX(),this._dy=this.deltaY(),this._dz=this.deltaZ(),this._reset=!1)}},{key:"postUpdate",value:function(){this.enable&&2!==this.phase&&(this.phase=2,this._reset&&(this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z),this.deltaAbsX()>=this.deltaAbsY()&&this.deltaAbsX()>=this.deltaAbsZ()?this.deltaX()<0?this.facing=n.BACKWARDX:this.deltaX()>0&&(this.facing=n.FORWARDX):this.deltaAbsY()>=this.deltaAbsX()&&this.deltaAbsY()>=this.deltaAbsZ()?this.deltaY()<0?this.facing=n.BACKWARDY:this.deltaY()>0&&(this.facing=n.FORWARDY):this.deltaZ()<0?this.facing=n.DOWN:this.deltaZ()>0&&(this.facing=n.UP),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),this._dz=this.deltaZ(),0!==this.deltaMax.x&&0!==this._dx&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),0!==this.deltaMax.y&&0!==this._dy&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),0!==this.deltaMax.z&&0!==this._dz&&(this._dz<0&&this._dz<-this.deltaMax.z?this._dz=-this.deltaMax.z:this._dz>0&&this._dz>this.deltaMax.z&&(this._dz=this.deltaMax.z)),this.sprite.isoX+=this._dx,this.sprite.isoY+=this._dy,this.sprite.isoZ+=this._dz),this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaR()),this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z,this._reset=!1)}},{key:"destroy",value:function(){this.sprite=null}},{key:"checkWorldBounds",value:function(){this.position.x<this.scene.isoPhysics.bounds.x&&this.scene.isoPhysics.checkCollision.backX?(this.position.x=this.scene.isoPhysics.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.backX=!0):this.frontX>this.scene.isoPhysics.bounds.frontX&&this.scene.isoPhysics.checkCollision.frontX&&(this.position.x=this.scene.isoPhysics.bounds.frontX-this.widthX,this.velocity.x*=-this.bounce.x,this.blocked.frontX=!0),this.position.y<this.scene.isoPhysics.bounds.y&&this.scene.isoPhysics.checkCollision.backY?(this.position.y=this.scene.isoPhysics.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.backY=!0):this.frontY>this.scene.isoPhysics.bounds.frontY&&this.scene.isoPhysics.checkCollision.frontY&&(this.position.y=this.scene.isoPhysics.bounds.frontY-this.widthY,this.velocity.y*=-this.bounce.y,this.blocked.frontY=!0),this.position.z<this.scene.isoPhysics.bounds.z&&this.scene.isoPhysics.checkCollision.down?(this.position.z=this.scene.isoPhysics.bounds.z,this.velocity.z*=-this.bounce.z,this.blocked.down=!0):this.top>this.scene.isoPhysics.bounds.top&&this.scene.isoPhysics.checkCollision.up&&(this.position.z=this.scene.isoPhysics.bounds.top-this.height,this.velocity.z*=-this.bounce.z,this.blocked.up=!0)}},{key:"setSize",value:function(t,i,s,e,h,o){void 0===e&&(e=this.offset.x),void 0===h&&(h=this.offset.y),void 0===o&&(o=this.offset.z),this.sourceWidthX=t,this.sourceWidthY=i,this.sourceHeight=s,this.widthX=this.sourceWidthX*this._sx,this.widthY=this.sourceWidthY*this._sx,this.height=this.sourceHeight*this._sy,this.halfWidthX=Math.floor(.5*this.widthX),this.halfWidthY=Math.floor(.5*this.widthY),this.halfHeight=Math.floor(.5*this.height),this.offset.setTo(e,h,o),this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight)}},{key:"reset",value:function(t,i,s){this.velocity.set(0),this.acceleration.set(0),this.angularVelocity=0,this.angularAcceleration=0,this.position.x=t+(this.widthX*-this.sprite.anchor.x+.5*this.widthX)+this.offset.x,this.position.y=i+(this.widthY*this.sprite.anchor.x-.5*this.widthY)+this.offset.y,this.position.z=s-Math.abs(this.sprite.height)*(1-this.sprite.anchor.y)+Math.abs(.5*this.sprite.width)+this.offset.z,this.prev.x=this.position.x,this.prev.y=this.position.y,this.prev.z=this.position.z,this.rotation=this.sprite.angle,this.preRotation=this.rotation,this._sx=this.sprite.scaleX,this._sy=this.sprite.scaleY,this.center.setTo(this.position.x+this.halfWidthX,this.position.y+this.halfWidthY,this.position.z+this.halfHeight),this.sprite._isoPositionChanged=!0}},{key:"hitTest",value:function(t,i,s){return o.default.contains(this,t,i,s)}},{key:"onFloor",value:function(){return this.blocked.down}},{key:"onWall",value:function(){return this.blocked.frontX||this.blocked.frontY||this.blocked.backX||this.blocked.backY}},{key:"deltaAbsX",value:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()}},{key:"deltaAbsY",value:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()}},{key:"deltaAbsZ",value:function(){return this.deltaZ()>0?this.deltaZ():-this.deltaZ()}},{key:"deltaX",value:function(){return this.position.x-this.prev.x}},{key:"deltaY",value:function(){return this.position.y-this.prev.y}},{key:"deltaZ",value:function(){return this.position.z-this.prev.z}},{key:"deltaR",value:function(){return this.rotation-this.preRotation}},{key:"getCorners",value:function(){return this._corners[0].setTo(this.x,this.y,this.z),this._corners[1].setTo(this.x,this.y,this.z+this.height),this._corners[2].setTo(this.x,this.y+this.widthY,this.z),this._corners[3].setTo(this.x,this.y+this.widthY,this.z+this.height),this._corners[4].setTo(this.x+this.widthX,this.y,this.z),this._corners[5].setTo(this.x+this.widthX,this.y,this.z+this.height),this._corners[6].setTo(this.x+this.widthX,this.y+this.widthY,this.z),this._corners[7].setTo(this.x+this.widthX,this.y+this.widthY,this.z+this.height),this._corners}},{key:"debugRender",value:function(t){var i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"rgba(0,255,0,0.4)",e=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],h=[],o=this.getCorners(),n=-this.scene.cameras.main.x,r=-this.scene.cameras.main.y;if(e){h=(h=[o[1],o[3],o[2],o[6],o[4],o[5],o[1]]).map(function(t){var s=i.scene.iso.projector.project(t);return s.x+=n,s.y+=r,s}),t.beginPath(),t.fillStyle=s,t.moveTo(h[0].x,h[0].y);for(var a=1;a<h.length;a++)t.lineTo(h[a].x,h[a].y);t.fill()}else h=(h=o.slice(0,o.length)).map(function(t){var s=i.scene.iso.projector.project(t);return s.x+=n,s.y+=r,s}),t.moveTo(h[0].x,h[0].y),t.beginPath(),t.strokeStyle=s,t.lineTo(h[1].x,h[1].y),t.lineTo(h[3].x,h[3].y),t.lineTo(h[2].x,h[2].y),t.lineTo(h[6].x,h[6].y),t.lineTo(h[4].x,h[4].y),t.lineTo(h[5].x,h[5].y),t.lineTo(h[1].x,h[1].y),t.lineTo(h[0].x,h[0].y),t.lineTo(h[4].x,h[4].y),t.moveTo(h[0].x,h[0].y),t.lineTo(h[2].x,h[2].y),t.moveTo(h[3].x,h[3].y),t.lineTo(h[7].x,h[7].y),t.lineTo(h[6].x,h[6].y),t.moveTo(h[7].x,h[7].y),t.lineTo(h[5].x,h[5].y),t.stroke(),t.closePath()}},{key:"top",get:function(){return this.position.z+this.height}},{key:"frontX",get:function(){return this.position.x+this.widthX}},{key:"right",get:function(){return this.position.x+this.widthX}},{key:"frontY",get:function(){return this.position.y+this.widthY}},{key:"bottom",get:function(){return this.position.y+this.widthY}},{key:"x",get:function(){return this.position.x},set:function(t){this.position.x=t}},{key:"y",get:function(){return this.position.y},set:function(t){this.position.y=t}},{key:"z",get:function(){return this.position.z},set:function(t){this.position.z=t}}]),t}();i.default=a},function(t,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=function(){function t(t,i){for(var s=0;s<i.length;s++){var e=i[s];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,s,e){return s&&t(i.prototype,s),e&&t(i,e),i}}(),h=l(s(6)),o=l(s(1)),n=l(s(0)),r=l(s(5)),a=s(2);function l(t){return t&&t.__esModule?t:{default:t}}var u=function(){function t(i,s){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,t),this.scene=i,this.projector=s,this.gravity=new n.default;var e=i.sys.game.config,h=e.width,a=e.height;this.bounds=new o.default(0,0,0,.5*h,.5*h,a),this.checkCollision={up:!0,down:!0,frontX:!0,frontY:!0,backX:!0,backY:!0},this.maxObjects=10,this.maxLevels=4,this.OVERLAP_BIAS=4,this.forceXY=!1,this.skipTree=!1,this.octree=new r.default(this.bounds.x,this.bounds.y,this.bounds.z,this.bounds.widthX,this.bounds.widthY,this.bounds.height,this.maxObjects,this.maxLevels),this._overlap=0,this._maxOverlap=0,this._velocity1=0,this._velocity2=0,this._newVelocity1=0,this._newVelocity2=0,this._average=0,this._mapData=[],this._result=!1,this._total=0,this._angle=0,this._dx=0,this._dy=0,this._dz=0}return e(t,[{key:"setBounds",value:function(t,i,s,e,h,o){this.bounds.setTo(t,i,s,e,h,o)}},{key:"setBoundsToWorld",value:function(){var t=scene.sys.game.config,i=t.width,s=t.height;this.bounds.setTo(0,0,0,.5*i,.5*i,s)}},{key:"enable",value:function(t){var i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=1;if(Array.isArray(t))for(s=t.length;s--;)t[s]instanceof Phaser.GameObjects.Group?this.enable(t[s].children,i):(this.enableBody(t[s]),i&&t[s].hasOwnProperty("children")&&t[s].children.length>0&&this.enable(t[s],!0));else t instanceof Phaser.GameObjects.Group?this.enable(t.children,i):(this.enableBody(t),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,!0))}},{key:"enableBody",value:function(t){t.hasOwnProperty("body")&&null===t.body&&(t.body=new h.default(t))}},{key:"updateMotion",value:function(t,i){this._velocityDelta=this.computeVelocity(0,t,t.angularVelocity,t.angularAcceleration,t.angularDrag,t.maxAngular)-t.angularVelocity,t.angularVelocity+=this._velocityDelta,t.rotation+=t.angularVelocity*i,t.velocity.x=this.computeVelocity(1,t,t.velocity.x,t.acceleration.x,t.drag.x,t.maxVelocity.x,i),t.velocity.y=this.computeVelocity(2,t,t.velocity.y,t.acceleration.y,t.drag.y,t.maxVelocity.y,i),t.velocity.z=this.computeVelocity(3,t,t.velocity.z,t.acceleration.z,t.drag.z,t.maxVelocity.z,i)}},{key:"computeVelocity",value:function(t,i,s,e,h,o,n){return o=o||1e4,1===t&&i.allowGravity?s+=(this.gravity.x+i.gravity.x)*n:2===t&&i.allowGravity?s+=(this.gravity.y+i.gravity.y)*n:3===t&&i.allowGravity&&(s+=(this.gravity.z+i.gravity.z)*n),e?s+=e*n:h&&(this._drag=h*n,s-this._drag>0?s-=this._drag:s+this._drag<0?s+=this._drag:s=0),s>o?s=o:s<-o&&(s=-o),s}},{key:"overlap",value:function(t,i,s,e,h){if(s=s||null,e=e||null,h=h||s,this._result=!1,this._total=0,Array.isArray(i))for(var o=0,n=i.length;o<n;o++)this.collideHandler(t,i[o],s,e,h,!0);else this.collideHandler(t,i,s,e,h,!0);return this._total>0}},{key:"collide",value:function(t,i,s,e,h){if(s=s||null,e=e||null,h=h||s,this._result=!1,this._total=0,Array.isArray(i))for(var o=0,n=i.length;o<n;o++)this.collideHandler(t,i[o],s,e,h,!1);else this.collideHandler(t,i,s,e,h,!1);return this._total>0}},{key:"collideHandler",value:function(t,i,s,e,h,o){i||t.type!==Phaser.GROUP?t&&i&&(t.type===a.ISOSPRITE?i.type===a.ISOSPRITE?this.collideSpriteVsSprite(t,i,s,e,h,o):i.type===Phaser.GROUP&&this.collideSpriteVsGroup(t,i,s,e,h,o):t.type===Phaser.GROUP&&(i.type===a.ISOSPRITE?this.collideSpriteVsGroup(i,t,s,e,h,o):i.type===Phaser.GROUP&&this.collideGroupVsGroup(t,i,s,e,h,o))):this.collideGroupVsSelf(t,s,e,h,o)}},{key:"collideSpriteVsSprite",value:function(t,i,s,e,h,o){return!(!t.body||!i.body)&&(this.separate(t.body,i.body,e,h,o)&&(s&&s.call(h,t,i),this._total++),!0)}},{key:"collideSpriteVsGroup",value:function(t,i,s,e,h,o){var n,r;if(0!==i.length&&t.body)if(t.body.skipTree||this.skipTree)for(n=0,r=i.children.length;n<r;n++)i.children[n]&&this.collideSpriteVsSprite(t,i.children[n],s,e,h,o);else for(this.octree.clear(),this.octree.reset(this.bounds.x,this.bounds.y,this.bounds.z,this.bounds.widthX,this.bounds.widthY,this.bounds.height,this.maxObjects,this.maxLevels),this.octree.populate(i),this._potentials=this.octree.retrieve(t),n=0,r=this._potentials.length;n<r;n++)this.separate(t.body,this._potentials[n],e,h,o)&&(s&&s.call(h,t,this._potentials[n].sprite),this._total++)}},{key:"collideGroupVsSelf",value:function(t,i,s,e,h){if(0!==t.length)for(var o=t.children.length,n=0;n<o;n++)for(var r=n+1;r<=o;r++)t.children[n]&&t.children[r]&&this.collideSpriteVsSprite(t.children[n],t.children[r],i,s,e,h)}},{key:"collideGroupVsGroup",value:function(t,i,s,e,h,o){if(0!==t.length&&0!==i.length)for(var n=0,r=t.children.length;n<r;n++)this.collideSpriteVsGroup(t.children[n],i,s,e,h,o)}},{key:"separate",value:function(t,i,s,e,h){return!!(t.enable&&i.enable&&this.intersects(t,i))&&((!s||!1!==s.call(e,t.sprite,i.sprite))&&(!!h||(this.forceXY||Math.abs(this.gravity.z+t.gravity.z)<Math.abs(this.gravity.x+t.gravity.x)||Math.abs(this.gravity.z+t.gravity.z)<Math.abs(this.gravity.y+t.gravity.y)?this._result=this.separateX(t,i,h)||this.separateY(t,i,h)||this.separateZ(t,i,h):this._result=this.separateZ(t,i,h)||this.separateX(t,i,h)||this.separateY(t,i,h),this._result)))}},{key:"intersects",value:function(t,i){return!(t.frontX<=i.x)&&(!(t.frontY<=i.y)&&(!(t.x>=i.frontX)&&(!(t.y>=i.frontY)&&(!(t.top<=i.z)&&!(t.z>=i.top)))))}},{key:"separateX",value:function(t,i,s){return(!t.immovable||!i.immovable)&&(this._overlap=0,!(!this.intersects(t,i)||(this._maxOverlap=t.deltaAbsX()+i.deltaAbsX()+this.OVERLAP_BIAS,0===t.deltaX()&&0===i.deltaX()?(t.embedded=!0,i.embedded=!0):t.deltaX()>i.deltaX()?(this._overlap=t.frontX-i.x,this._overlap>this._maxOverlap||!1===t.checkCollision.frontX||!1===i.checkCollision.backX?this._overlap=0:(t.touching.none=!1,t.touching.frontX=!0,i.touching.none=!1,i.touching.backX=!0)):t.deltaX()<i.deltaX()&&(this._overlap=t.x-i.widthX-i.x,-this._overlap>this._maxOverlap||!1===t.checkCollision.backX||!1===i.checkCollision.frontX?this._overlap=0:(t.touching.none=!1,t.touching.backX=!0,i.touching.none=!1,i.touching.frontX=!0)),0===this._overlap))&&(t.overlapX=this._overlap,i.overlapX=this._overlap,!!(s||t.customSeparateX||i.customSeparateX)||(this._velocity1=t.velocity.x,this._velocity2=i.velocity.x,t.immovable||i.immovable?t.immovable?i.immovable||(i.x+=this._overlap,i.velocity.x=this._velocity1-this._velocity2*i.bounce.x):(t.x=t.x-this._overlap,t.velocity.x=this._velocity2-this._velocity1*t.bounce.x):(this._overlap*=.5,t.x=t.x-this._overlap,i.x+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*i.mass/t.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*t.mass/i.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,t.velocity.x=this._average+this._newVelocity1*t.bounce.x,i.velocity.x=this._average+this._newVelocity2*i.bounce.x),!0)))}},{key:"separateY",value:function(t,i,s){return(!t.immovable||!i.immovable)&&(this._overlap=0,!(!this.intersects(t,i)||(this._maxOverlap=t.deltaAbsY()+i.deltaAbsY()+this.OVERLAP_BIAS,0===t.deltaY()&&0===i.deltaY()?(t.embedded=!0,i.embedded=!0):t.deltaY()>i.deltaY()?(this._overlap=t.frontY-i.y,this._overlap>this._maxOverlap||!1===t.checkCollision.frontY||!1===i.checkCollision.backY?this._overlap=0:(t.touching.none=!1,t.touching.frontY=!0,i.touching.none=!1,i.touching.backY=!0)):t.deltaY()<i.deltaY()&&(this._overlap=t.y-i.widthY-i.y,-this._overlap>this._maxOverlap||!1===t.checkCollision.backY||!1===i.checkCollision.frontY?this._overlap=0:(t.touching.none=!1,t.touching.backY=!0,i.touching.none=!1,i.touching.frontY=!0)),0===this._overlap))&&(t.overlapY=this._overlap,i.overlapY=this._overlap,!!(s||t.customSeparateY||i.customSeparateY)||(this._velocity1=t.velocity.y,this._velocity2=i.velocity.y,t.immovable||i.immovable?t.immovable?i.immovable||(i.y+=this._overlap,i.velocity.y=this._velocity1-this._velocity2*i.bounce.y):(t.y=t.y-this._overlap,t.velocity.y=this._velocity2-this._velocity1*t.bounce.y):(this._overlap*=.5,t.y=t.y-this._overlap,i.y+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*i.mass/t.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*t.mass/i.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,t.velocity.y=this._average+this._newVelocity1*t.bounce.y,i.velocity.y=this._average+this._newVelocity2*i.bounce.y),!0)))}},{key:"separateZ",value:function(t,i,s){return(!t.immovable||!i.immovable)&&(this._overlap=0,!(!this.intersects(t,i)||(this._maxOverlap=t.deltaAbsZ()+i.deltaAbsZ()+this.OVERLAP_BIAS,0===t.deltaZ()&&0===i.deltaZ()?(t.embedded=!0,i.embedded=!0):t.deltaZ()>i.deltaZ()?(this._overlap=t.top-i.z,this._overlap>this._maxOverlap||!1===t.checkCollision.down||!1===i.checkCollision.up?this._overlap=0:(t.touching.none=!1,t.touching.down=!0,i.touching.none=!1,i.touching.up=!0)):t.deltaZ()<i.deltaZ()&&(this._overlap=t.z-i.top,-this._overlap>this._maxOverlap||!1===t.checkCollision.up||!1===i.checkCollision.down?this._overlap=0:(t.touching.none=!1,t.touching.up=!0,i.touching.none=!1,i.touching.down=!0)),0===this._overlap))&&(t.overlapZ=this._overlap,i.overlapZ=this._overlap,!!(s||t.customSeparateY||i.customSeparateZ)||(this._velocity1=t.velocity.z,this._velocity2=i.velocity.z,t.immovable||i.immovable?t.immovable?i.immovable||(i.z+=this._overlap,i.velocity.z=this._velocity1-this._velocity2*i.bounce.z,t.moves&&(i.x+=t.x-t.prev.x,i.y+=t.y-t.prev.y)):(t.z=t.z-this._overlap,t.velocity.z=this._velocity2-this._velocity1*t.bounce.z,i.moves&&(t.x+=i.x-i.prev.x,t.y+=i.y-i.prev.y)):(this._overlap*=.5,t.z=t.z-this._overlap,i.z+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*i.mass/t.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*t.mass/i.mass)*(this._velocity1>0?1:-1),this._average=.5*(this._newVelocity1+this._newVelocity2),this._newVelocity1-=this._average,this._newVelocity2-=this._average,t.velocity.z=this._average+this._newVelocity1*t.bounce.z,i.velocity.z=this._average+this._newVelocity2*i.bounce.z),!0)))}},{key:"distanceBetween",value:function(t,i){return this._dx=t.x-i.x,this._dy=t.y-i.y,this._dz=t.z-i.z,Math.sqrt(this._dx*this._dx+this._dy*this._dy+this._dz*this._dz)}},{key:"distanceToXY",value:function(t,i,s){return this._dx=t.x-i,this._dy=t.y-s,Math.sqrt(this._dx*this._dx+this._dy*this._dy)}},{key:"distanceToXYZ",value:function(t,i,s,e){return this._dx=t.x-i,this._dy=t.y-s,this._dz=t.z-e,Math.sqrt(this._dx*this._dx+this._dy*this._dy+this._dz*this._dz)}},{key:"distanceToPointer",value:function(t,i){i=i||this.scene.input.activePointer;var s=this.projector.unproject(i.position,void 0,t.z);return s.z=t.z,this.anglesToXYZ(t,s.x,s.y,s.z).r}},{key:"anglesToXYZ",value:function(t,i,s,e){var h=this.distanceToXYZ(t,i,s,e);return{r:h,theta:Math.atan2(s-t.y,i-t.x),phi:Math.acos((e-t.z)/h)}}},{key:"angleToPointer",value:function(t,i){i=i||this.scene.input.activePointer;var s=this.projector.unproject(i.position,void 0,t.z);return s.z=t.z,this.anglesToXYZ(t,s.x,s.y,s.z).theta}},{key:"velocityFromAngles",value:function(t,i,s,e){return void 0===i&&(i=Math.sin(Math.PI/2)),void 0===s&&(s=60),e=e||new Phaser.Point,new n.default(Math.cos(t)*Math.sin(i)*s,Math.sin(t)*Math.sin(i)*s,Math.cos(i)*s)}},{key:"accelerateToXYZ",value:function(t,i,s,e,h,o,n,r){void 0===h&&(h=60),void 0===o&&(o=500),void 0===n&&(n=500),void 0===r&&(r=500);var a=this.anglesToXYZ(t.body,i,s,e),l=this.velocityFromAngles(a.theta,a.phi,h);return t.body.acceleration.setTo(l.x,l.y,l.z),t.body.maxVelocity.setTo(o,n,r),a.theta}},{key:"moveToXYZ",value:function(t,i,s,e,h,o){void 0===h&&(h=60),void 0===o&&(o=0),o>0&&(h=this.distanceToXYZ(t.body,i,s,e)/(o/1e3));var n=this.anglesToXYZ(t.body,i,s,e),r=this.velocityFromAngles(n.theta,n.phi,h);return t.body.velocity.copyFrom(r),n.theta}},{key:"moveToObject",value:function(t,i,s,e){return this.moveToXYZ(t,i.x,i.y,i.z,s,e)}},{key:"moveToPointer",value:function(t,i,s,e){s=s||this.game.input.activePointer;var h=this.game.iso.unproject(s.position,void 0,t.body.z);h.z=t.body.z,void 0===i&&(i=60),void 0===e&&(e=0),e>0&&(i=this.distanceToXYZ(t.body,h.x,h.y,h.z)/(e/1e3));var o=this.anglesToXYZ(t.body,h.x,h.y,h.z),n=this.velocityFromAngles(o.theta,o.phi,i);return t.body.velocity.x=n.x,t.body.velocity.y=n.y,o.theta}},{key:"preUpdate",value:function(t,i){for(var s=this.scene.children.list,e=s.length,h=0;h<e;h++){var o=s[h];if(!o.body)return;o.body.preUpdate(t,i)}}},{key:"postUpdate",value:function(){for(var t=this.scene.children.list,i=t.length,s=0;s<i;s++){var e=t[s];if(!e.body)return;var h=Object.assign([],t);h.splice(s,1),this.collide(e,h),e.body.postUpdate()}}},{key:"boot",value:function(){var t=this.scene.sys.events;t.on("preupdate",this.preUpdate,this),t.on("postupdate",this.postUpdate,this)}}],[{key:"register",value:function(i){i.register("IsoPhysics",t,"isoPhysics")}}]),t}();i.default=u},function(t,i,s){t.exports=s(2)}]);